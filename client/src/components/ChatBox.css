.chatbox{
  border:1px solid var(--color-border);
  border-radius:16px;
  background:#fff;
  display:flex; flex-direction:column;
  min-height:60vh;
  box-shadow: var(--shadow-small);
  overflow:hidden;
}

/* رأس المحادثة */
.chat-header{
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 12px;
  background: linear-gradient(180deg, rgba(var(--rgb-primary),.06), transparent);
  border-bottom:1px solid var(--color-border);
}
.chat-header .who{ display:flex; align-items:center; gap:10px; }
.chat-header .who img{ width:38px; height:38px; border-radius:50%; object-fit:cover; }
.chat-header .who-text .name{ font-weight:800; color:#0f172a; line-height:1; }
.chat-header .who-text .typing{ font-size:.85rem; color:#0ea5e9; opacity:0; height:1.1em; transition:opacity .2s; }
.chat-header .who-text .typing.show{ opacity:1; }
.chat-header .jump{
  width:36px; height:36px; border-radius:999px; border:1px solid var(--color-border);
  background:#fff; display:inline-flex; align-items:center; justify-content:center; cursor:pointer;
  transition: transform .15s ease;
}
.chat-header .jump:hover{ transform: translateY(-1px); }

/* مساحة الرسائل */
.chat-viewport{
  flex:1; overflow:auto; padding:14px 12px; background: #fafcff;
  display:flex; flex-direction:column; gap:10px;
}
.more-loading, .loading{
  display:flex; justify-content:center; align-items:center; gap:8px; color:#64748b; padding:6px 0;
}

/* رسالة */
.msg{ display:flex; align-items:flex-end; gap:8px; max-width:85%; }
.msg .avatar{ width:32px; height:32px; border-radius:50%; object-fit:cover; }
.msg .bubble{
  background:#fff; border:1px solid var(--color-border); border-radius:14px; padding:8px 10px;
  box-shadow: 0 1px 2px rgba(0,0,0,.04);
}
.msg .text{ white-space:pre-wrap; line-height:1.35; color:#111827; }
.msg .att{ margin-top:6px; font-size:.9rem; color:#0b7285; display:inline-flex; align-items:center; gap:6px; }

.msg .meta{
  display:flex; align-items:center; gap:8px; color:#6b7280; font-size:.78rem; margin-top:4px;
}
.msg .status svg{ vertical-align:middle; }
.msg .status .failed{ color:#ef4444; font-weight:800; }

/* محاذاة */
.msg.mine{ align-self:flex-end; flex-direction: row-reverse; }
.msg.mine .bubble{
  background: #e7f7f0;
  border-color: rgba(var(--rgb-primary), .35);
}
.msg.theirs{ align-self:flex-start; }
.msg.theirs .bubble{
  background:#fff;
}
.msg.mine .meta{ justify-content:flex-end; }

/* إدخال الرسالة */
.chat-input{
  display:flex; align-items:center; gap:8px;
  border-top:1px solid var(--color-border);
  padding:8px; background:#fff;
}
.chat-input textarea{
  flex:1; resize:none; max-height:140px;
  border:1px solid var(--color-border); border-radius:12px; padding:10px 12px;
  outline:none; transition: box-shadow .15s ease, border-color .15s ease;
}
.chat-input textarea:focus{
  border-color: var(--color-primary-base);
  box-shadow: 0 0 0 3px rgba(var(--rgb-primary), .15);
}
.chat-input .send{
  width:44px; height:44px; border-radius:12px; border:1px solid var(--color-border);
  background: var(--color-primary-base); color:#fff; display:inline-flex; align-items:center; justify-content:center;
  transition: transform .15s ease, filter .15s ease;
}
.chat-input .send:disabled{ filter: grayscale(40%); opacity:.8; }
.chat-input .send:hover:not(:disabled){ transform: translateY(-1px); }

.chat-input .attach{
  width:44px; height:44px; border-radius:12px; border:1px solid var(--color-border);
  background:#fff; color:#111827; display:inline-flex; align-items:center; justify-content:center; cursor:pointer;
  transition: transform .15s ease;
}
.chat-input .attach:hover{ transform: translateY(-1px); }

.attach-preview{
  display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border:1px dashed var(--color-border);
  border-radius:10px; font-size:.85rem; color:#0b7285; background:#f8fafc; max-width:40%;
  overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
}
.attach-preview .clear{
  border:none; background:transparent; color:#ef4444; font-weight:800; cursor:pointer; padding:0 4px;
}

/* Responsive */
@media (max-width: 576px) {
  .msg{ max-width:92%; }
  .chat-input .attach, .chat-input .send{ width:40px; height:40px; }
}
